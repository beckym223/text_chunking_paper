# Libraries

```{r message=FALSE, warning=FALSE}

library(tidyverse)
library(stringr)
library(stringi)

source("text_funcs.R")

```


# Load paragraph data frame, make output dir

```{r}
para_df_path<-"data_const/para_df.csv"
para_df<-read_csv(para_df_path,show_col_types = F)
output.dir<-"chunked_dfs"

if(!dir.exists(output.dir)){
    dir.create(output.dir, recursive = T)
}
```




# Chunking Strategy 1: Full documents

```{r}
doc_df <- para_df %>%
  group_by(doc_id) %>%
  summarize(
    meeting_num = first(meeting_num),
    text = paste(text, collapse = "\n"),
    .groups = "drop"
  ) %>%
  mutate(text_id = as.character(doc_id)) %>%
  select(text_id, meeting_num, text)

```

# Chunking Strategy 2: Original document pages

```{r}
page_df <- read_csv("data_const/page_df.csv", show_col_types = FALSE) %>%
  rename(text_id=page_id)%>%
  transmute(
    doc_id,
    text_id,
    meeting_num,
    text
  )

```


# Chunking Strategy 3: Fixed size chunks, nearest sentence
```{r}
sent_200_df <- make_sentence_chunks(doc_df, 200)
sent_500_df <- make_sentence_chunks(doc_df, 500)
```

# Chunking strategy 4: Author-created paragraphs
```{r}

out.path = file.path(output.dir, "para_df.csv")
write_csv(og_para_df,out.path)

```

# Put into named list
```{r}
chunked_dfs <- list(
  document  = doc_df,
  page      = page_df,
  paragraph = para_df,
  sent_200  = sent_200_df,
  sent_500  = sent_500_df
)
```

```{r}
output_dir <- "chunked_dfs"
dir.create(output_dir, showWarnings = FALSE, recursive = TRUE)

saveRDS(
  chunked_dfs,
  file = file.path(output_dir, "chunked_dfs.rds")
)


#save to csv also

iwalk(
  chunked_dfs,
  ~ write_csv(.x, file.path(output_dir, paste0(.y, ".csv")))
)
```

